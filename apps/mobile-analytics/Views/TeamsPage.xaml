<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:PulseDev.Mobile.ViewModels"
             x:Class="PulseDev.Mobile.Views.TeamsPage"
             Title="My Teams"
             x:DataType="vm:TeamsViewModel">

    <ScrollView>
        <StackLayout Padding="20"
                Spacing="20">

            <!-- Join Team Section -->
            <Frame BackgroundColor="#1E40AF"
                    HasShadow="True"
                    CornerRadius="10">
                <StackLayout>
                    <Label Text="ðŸš€ Join a Team"
                           FontSize="20"
                           FontAttributes="Bold"
                           TextColor="White"
                           HorizontalOptions="Center"/>

                    <Entry x:Name="UsernameEntry"
                           Text="{Binding Username}"
                           Placeholder="Your username"
                           PlaceholderColor="LightBlue"
                           TextColor="White"
                           BackgroundColor="Transparent"/>

                    <Entry x:Name="InviteCodeEntry"
                           Text="{Binding JoinCode}"
                           Placeholder="Enter invite code (e.g., ABC123XY)"
                           PlaceholderColor="LightBlue"
                           TextColor="White"
                           BackgroundColor="Transparent"
                           MaxLength="10"/>

                    <Button Text="Join Team"
                            Command="{Binding JoinTeamCommand}"
                            IsEnabled="{Binding IsJoining, Converter={StaticResource InverseBoolConverter}}"
                            BackgroundColor="White"
                            TextColor="#1E40AF"
                            CornerRadius="8"
                            FontSize="16"
                            FontAttributes="Bold"/>

                    <ActivityIndicator IsVisible="{Binding IsJoining}"
                                       IsRunning="{Binding IsJoining}"
                                       Color="White"/>
                </StackLayout>
            </Frame>

            <!-- Loading Indicator -->
            <ActivityIndicator IsVisible="{Binding IsLoading}"
                               IsRunning="{Binding IsLoading}"
                               Color="#1E40AF"/>

            <!-- My Teams -->
            <Label Text="ðŸ‘¥ My Teams"
                   FontSize="20"
                   FontAttributes="Bold"
                   IsVisible="{Binding Teams.Count}"/>

            <CollectionView ItemsSource="{Binding Teams}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame BackgroundColor="White"
                                HasShadow="True"
                                CornerRadius="10"
                                Margin="0,5">
                            <Grid RowDefinitions="Auto,Auto,Auto"
                                    ColumnDefinitions="*,Auto">

                                <!-- Team Name -->
                                <Label Grid.Row="0"
                                        Grid.Column="0"
                                       Text="{Binding Name}"
                                       FontSize="18"
                                       FontAttributes="Bold"
                                       TextColor="#1F2937"/>

                                <!-- Member Count -->
                                <Label Grid.Row="0"
                                        Grid.Column="1"
                                       Text="{Binding MemberCount, StringFormat='{0} members'}"
                                       FontSize="14"
                                       TextColor="#6B7280"
                                       VerticalOptions="Center"/>

                                <!-- Description -->
                                <Label Grid.Row="1"
                                        Grid.Column="0"
                                        Grid.ColumnSpan="2"
                                       Text="{Binding Description}"
                                       FontSize="14"
                                       TextColor="#6B7280"
                                       IsVisible="{Binding Description, Converter={StaticResource IsNotNullOrEmptyConverter}}"
                                       Margin="0,5,0,0"/>

                                <!-- Integrations -->
                                <StackLayout Grid.Row="2"
                                        Grid.Column="0"
                                        Grid.ColumnSpan="2"
                                             Orientation="Horizontal"
                                             Margin="0,10,0,0">

                                    <Frame IsVisible="{Binding Integrations.SlackChannel, Converter={StaticResource IsNotNullOrEmptyConverter}}"
                                           BackgroundColor="#4A154B"
                                           CornerRadius="15"
                                           Padding="8,4"
                                           HasShadow="False">
                                        <Label Text="{Binding Integrations.SlackChannel, StringFormat='ðŸ’¬ {0}'}"
                                               TextColor="White"
                                               FontSize="12"/>
                                    </Frame>

                                    <Frame IsVisible="{Binding Integrations.JiraProjectKey, Converter={StaticResource IsNotNullOrEmptyConverter}}"
                                           BackgroundColor="#0052CC"
                                           CornerRadius="15"
                                           Padding="8,4"
                                           HasShadow="False"
                                           Margin="5,0,0,0">
                                        <Label Text="{Binding Integrations.JiraProjectKey, StringFormat='ðŸŽ« {0}'}"
                                               TextColor="White"
                                               FontSize="12"/>
                                    </Frame>
                                </StackLayout>

                                <!-- Team Members Preview -->
                                <CollectionView Grid.Row="3"
                                        Grid.Column="0"
                                        Grid.ColumnSpan="2"
                                                ItemsSource="{Binding Members}"
                                                Margin="0,10,0,0"
                                                MaximumHeightRequest="100">
                                    <CollectionView.ItemsLayout>
                                        <LinearItemsLayout Orientation="Horizontal"
                                                ItemSpacing="5"/>
                                    </CollectionView.ItemsLayout>
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate>
                                            <Frame BackgroundColor="{Binding StatusColor}"
                                                   CornerRadius="20"
                                                   Padding="10,5"
                                                   HasShadow="False">
                                                <StackLayout Orientation="Horizontal"
                                                        Spacing="5">
                                                    <Label Text="{Binding IsOnline, Converter={StaticResource OnlineStatusConverter}}"
                                                           FontSize="10"/>
                                                    <Label Text="{Binding Username}"
                                                           FontSize="12"
                                                           TextColor="White"
                                                           FontAttributes="Bold"/>
                                                    <Label Text="{Binding RoleDisplayName}"
                                                           FontSize="10"
                                                           TextColor="White"
                                                           Opacity="0.8"/>
                                                </StackLayout>
                                            </Frame>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>

                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- No Teams Message -->
            <Frame IsVisible="{Binding Teams.Count, Converter={StaticResource CountToBoolConverter}}"
                   BackgroundColor="#F3F4F6"
                   HasShadow="False"
                   CornerRadius="10"
                   Padding="20">
                <StackLayout HorizontalOptions="Center">
                    <Label Text="ðŸ‘‹"
                            FontSize="48"
                            HorizontalOptions="Center"/>
                    <Label Text="No Teams Yet"
                           FontSize="18"
                           FontAttributes="Bold"
                           HorizontalOptions="Center"/>
                    <Label Text="Join your first team using an invite code from your Scrum Master"
                           FontSize="14"
                           TextColor="#6B7280"
                           HorizontalOptions="Center"
                           HorizontalTextAlignment="Center"
                           Margin="0,10,0,0"/>
                </StackLayout>
            </Frame>

            <!-- Refresh Button -->
            <Button Text="ðŸ”„ Refresh Teams"
                    Command="{Binding LoadTeamsCommand}"
                    BackgroundColor="#10B981"
                    TextColor="White"
                    CornerRadius="8"
                    FontSize="16"/>

        </StackLayout>
    </ScrollView>
</ContentPage>
